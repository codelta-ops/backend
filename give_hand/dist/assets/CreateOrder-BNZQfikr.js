import{_ as w,r as d,a as C,c as i,b as t,w as m,v as f,F as U,f as I,t as F,e as L,o as u,y as O}from"./index-CeEdpuPy.js";import{f as R}from"./orders-L_Q0EYNJ.js";import{i as D}from"./http-CWkExEYz.js";function V(g){const p=new FormData;return p.append("file",g),D.post("/file/upload/image",p,{headers:{"Content-Type":"multipart/form-data"}})}const A={class:"page"},B={class:"top"},$={class:"main"},j={class:"form-group"},E={class:"form-group"},M={class:"form-group"},P={class:"form-group"},T={key:0,class:"upload-placeholder"},x={key:1,class:"image-preview"},N=["src"],S=["onClick"],q=["disabled"],z={__name:"CreateOrder",setup(g){const p=L(),c=d(!1),v=d(null),n=d([]),s=C({title:"",price:"",content:"",images:[]});function y(){var l;(l=v.value)==null||l.click()}function b(l){const e=Array.from(l.target.files);if(e.length+s.images.length>3){alert("最多只能上传 3 张图片");return}const a=e.slice(0,3-s.images.length);s.images.push(...a),a.forEach(r=>{const o=URL.createObjectURL(r);n.value.push(o)}),l.target.value=""}function _(l){URL.revokeObjectURL(n.value[l]),n.value.splice(l,1),s.images.splice(l,1)}async function h(){if(!s.title||!s.price||!s.content){alert("请填写完整信息");return}c.value=!0;try{const l=[];if(s.images.length>0){const a=s.images.map(o=>V(o)),r=await Promise.all(a);for(const o of r)if(o.data&&typeof o.data=="string"){const k="http://"+o.data;l.push(k)}}const e={title:s.title,price:s.price,content:s.content,images:l};await R(e),alert("发布成功"),p.replace("/orders")}catch(l){console.error(l),alert(l.message||"发布失败")}finally{c.value=!1}}return(l,e)=>(u(),i("div",A,[t("header",B,[t("button",{class:"back",onClick:e[0]||(e[0]=a=>l.$router.back())},"←"),e[4]||(e[4]=t("div",{class:"title"},"发布订单",-1))]),t("main",$,[t("div",j,[e[5]||(e[5]=t("label",null,"标题",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.title=a),placeholder:"请输入订单标题"},null,512),[[f,s.title]])]),t("div",E,[e[6]||(e[6]=t("label",null,"金额",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.price=a),type:"number",placeholder:"请输入金额"},null,512),[[f,s.price,void 0,{number:!0}]])]),t("div",M,[e[7]||(e[7]=t("label",null,"详情",-1)),m(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.content=a),rows:"5",placeholder:"请详细描述任务内容、时间地点等"},null,512),[[f,s.content]])]),t("div",P,[e[8]||(e[8]=t("label",null,"上传图片（最多3张）",-1)),t("div",{class:"image-upload-area",onClick:y},[t("input",{ref_key:"fileInput",ref:v,type:"file",accept:"image/*",multiple:"",onChange:b,style:{display:"none"}},null,544),n.value.length===0?(u(),i("div",T," ＋ 点击选择图片 ")):(u(),i("div",x,[(u(!0),i(U,null,I(n.value,(a,r)=>(u(),i("div",{key:r,class:"preview-item"},[t("img",{src:a,alt:"预览"},null,8,N),t("button",{class:"remove-btn",onClick:O(o=>_(r),["stop"])},"×",8,S)]))),128))]))]),e[9]||(e[9]=t("div",{class:"image-tip"},"建议上传清晰实拍图，提高接单率",-1))]),t("button",{class:"primary",onClick:h,disabled:c.value},F(c.value?"发布中...":"发布订单"),9,q)])]))}},K=w(z,[["__scopeId","data-v-7f913451"]]);export{K as default};
