import{_ as b,r as n,l as C,m as Y,p as B,c as v,b as l,w as S,v as V,q,s as E,F as z,f as F,t as H,e as K,o as u,x as N}from"./index-CeEdpuPy.js";import{g as R,T as U}from"./TaskCard-0sBTdkhh.js";import"./http-CWkExEYz.js";const $={class:"page"},A={class:"header"},I={key:0,class:"refresh-indicator"},P={class:"grid"},j={key:1,class:"load-more"},G=["disabled"],J=8,O=100,Q={__name:"Home",setup(W){const m=K(),c=n(""),r=n([]),d=n(1),_=n(0),t=n(!1),o=n(!1),k=n(0),i=n(0),f=n(null),y=C(()=>r.value.length>0&&r.value.length<_.value);async function h(e=!1){if(t.value)return;e&&(d.value=1);const s={page:d.value,size:J,t:Date.now()};t.value=!0,o.value=e;try{const a=await R(s);e?r.value=a.results||[]:r.value=[...r.value,...a.results||[]],_.value=a.total||0}catch(a){console.error("获取任务失败:",a)}finally{t.value=!1,o.value=!1}}async function D(){o.value||t.value||(i.value=0,await h(!0))}function L(){!y.value||t.value||(d.value+=1,h(!1))}function x(e){m.push(`/orders/${e}`)}function M(){c.value.trim()&&m.push({name:"SearchResult",query:{keyword:c.value}})}function g(e){o.value||t.value||(k.value=e.touches[0].clientY)}function T(e){if(o.value||t.value)return;const s=f.value;if(!s||s.scrollTop>0)return;const p=e.touches[0].clientY-k.value;p>0&&(e.preventDefault(),i.value=Math.min(p*.5,O),i.value>=60&&!o.value&&D())}function w(){i.value=0}return Y(()=>{h(!0);const e=f.value;e&&(e.addEventListener("touchstart",g,{passive:!1}),e.addEventListener("touchmove",T,{passive:!1}),e.addEventListener("touchend",w),B(()=>{e.removeEventListener("touchstart",g),e.removeEventListener("touchmove",T),e.removeEventListener("touchend",w)}))}),(e,s)=>(u(),v("div",$,[l("header",A,[S(l("input",{class:"search","onUpdate:modelValue":s[0]||(s[0]=a=>c.value=a),placeholder:"搜索帖子、用户或金额",onKeyup:q(M,["enter"])},null,544),[[V,c.value]])]),l("main",{class:"main",ref_key:"mainRef",ref:f},[o.value?(u(),v("div",I,[...s[1]||(s[1]=[l("div",{class:"refresh-spinner"},null,-1),l("span",null,"刷新中...",-1)])])):E("",!0),l("div",P,[(u(!0),v(z,null,F(r.value,a=>(u(),N(U,{key:a.id,task:a,onClick:p=>x(a.id),class:"task-card"},null,8,["task","onClick"]))),128))]),y.value?(u(),v("div",j,[l("button",{onClick:L,disabled:t.value},H(t.value?"加载中...":"加载更多"),9,G)])):E("",!0)],512)]))}},ae=b(Q,[["__scopeId","data-v-8aa45c5b"]]);export{ae as default};
